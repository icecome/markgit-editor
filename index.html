<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MarkGit Editor</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%232196f3;stop-opacity:1'/%3E%3Cstop offset='100%25' style='stop-color:%231976d2;stop-opacity:1'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='32' height='32' rx='8' fill='url(%23grad)'/%3E%3Cg fill='white'%3E%3Ccircle cx='16' cy='8' r='3'/%3E%3Ccircle cx='10' cy='22' r='3'/%3E%3Ccircle cx='22' cy='22' r='3'/%3E%3Cpath d='M16 11v5a3 3 0 0 1-3 3H11' stroke='white' stroke-width='2' fill='none' stroke-linecap='round'/%3E%3Cpath d='M16 16a3 3 0 0 0 3 3h2' stroke='white' stroke-width='2' fill='none' stroke-linecap='round'/%3E%3C/g%3E%3C/svg%3E" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com/3.4.1"></script>
    <script src="https://unpkg.com/lucide@0.344.0"></script>
    <script src="https://unpkg.com/vue@3.4.21/dist/vue.global.prod.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/vditor@3.10.4/dist/index.css">
    <script src="https://unpkg.com/vditor@3.10.4/dist/index.min.js"></script>
    <script src="https://unpkg.com/axios@1.6.7/dist/axios.min.js"></script>
    <script src="https://unpkg.com/dompurify@3.0.8/dist/purify.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/main.css">
    <style>
        .settings-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .settings-panel-content::-webkit-scrollbar {
            width: 6px;
        }
        .settings-panel-content::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 3px;
        }
        .settings-panel-content::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }
        .settings-panel-content::-webkit-scrollbar-thumb:hover {
            background: var(--accent-color);
        }
        
        .side-panel-footer-fixed {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px 20px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            flex-shrink: 0;
            z-index: 10;
        }
        
        .section-subtitle {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin: 12px 0 8px 0;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .pattern-templates {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 12px;
        }
        .pattern-template {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            transition: border-color 0.15s ease, background-color 0.15s ease;
            display: flex;
            flex-direction: column;
            gap: 2px;
            min-width: 80px;
            flex: 0 0 auto;
        }
        .pattern-template:hover {
            border-color: var(--accent-color);
            background: rgba(59, 130, 246, 0.05);
        }
        .pattern-template code {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: var(--accent-color);
            background: rgba(59, 130, 246, 0.1);
            padding: 2px 5px;
            border-radius: 3px;
            align-self: flex-start;
        }
        .pattern-template span {
            font-size: 10px;
            color: var(--text-tertiary);
            white-space: nowrap;
        }
        
        .regex-help {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 8px 10px;
            margin-bottom: 12px;
        }
        .help-item {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
            line-height: 1.4;
        }
        .help-item:last-child {
            margin-bottom: 0;
        }
        .help-item code {
            font-family: 'Courier New', monospace;
            font-size: 10px;
            color: var(--accent-color);
            background: rgba(59, 130, 246, 0.1);
            padding: 1px 4px;
            border-radius: 3px;
            display: inline-block;
        }
        
        /* è¡¨å•ä¼˜åŒ– */
        .form-group {
            margin-bottom: 12px;
        }
        .form-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 6px;
            display: block;
        }
        .form-textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        
        .section-divider {
            border-top: 1px solid var(--border-color);
            margin: 12px 0;
        }
    </style>
</head>
<body>
<div id="app">
    <nav class="navbar">
        <div class="navbar-content">
            <div style="display: flex; align-items: center;">
                <button class="mobile-menu-toggle" @click="toggleSidebar" title="èœå•" style="display: none;">
                    <i data-lucide="menu" style="width: 20px; height: 20px;"></i>
                </button>
                <div class="logo">
                    <div class="logo-icon">
                        <i data-lucide="edit-3" style="width: 18px; height: 18px;"></i>
                    </div>
                    <span>MarkGit Editor</span>
                </div>
            </div>
            <div class="nav-actions">
                <button class="btn btn-success" @click="showChangesPanel()" title="æäº¤å˜æ›´">
                    <i data-lucide="git-commit" style="width: 14px; height: 14px;"></i>
                    <span>æäº¤</span>
                </button>
                <button class="btn btn-ghost" @click="initWorkspace()" title="åˆå§‹åŒ–ä»“åº“ï¼ˆè‡ªåŠ¨å…‹éš†è¿œç¨‹ä»“åº“ï¼‰">
                    <i data-lucide="git-branch-plus" style="width: 14px; height: 14px;"></i>
                    <span>åˆå§‹åŒ–</span>
                </button>
                <button class="btn btn-ghost" @click="pullRepo()" title="æ‹‰å–æ›´æ–°">
                    <i data-lucide="git-pull-request" style="width: 14px; height: 14px;"></i>
                    <span>æ‹‰å–</span>
                </button>
                <div id="oauth-container" style="display: inline-flex; align-items: center;"></div>
                
                <button class="btn btn-ghost" @click="showThemePanel()" title="ä¸»é¢˜è®¾ç½®">
                    <i data-lucide="palette" style="width: 14px; height: 14px;"></i>
                </button>
                <button class="btn btn-ghost" @click="showConfigPanel()" title="è®¾ç½®">
                    <i data-lucide="settings" style="width: 14px; height: 14px;"></i>
                </button>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <div class="sidebar" :class="{ 'collapsed': sidebarCollapsed, 'open-mobile': showMobileOverlay }">
            <div class="sidebar-toggle" @click="toggleSidebar" title="æŠ˜å /å±•å¼€æ–‡ä»¶æµè§ˆå™¨">
                <i data-lucide="chevron-left" style="width: 14px; height: 14px; display: inline-block;" v-show="!sidebarCollapsed"></i>
                <i data-lucide="chevron-right" style="width: 14px; height: 14px; display: inline-block;" v-show="sidebarCollapsed"></i>
            </div>
            <div class="sidebar-header">
                <div class="sidebar-title">æ–‡ä»¶æµè§ˆå™¨</div>
                <div class="sidebar-actions" style="display: flex; flex-direction: column; gap: 8px;">
                    <button class="btn btn-sm btn-secondary" @click="showNewFolderPanel()" title="åœ¨å½“å‰ç›®å½•æ–°å»ºæ–‡ä»¶å¤¹" style="width: 100%; justify-content: center;">
                        <i data-lucide="folder-plus" style="width: 12px; height: 12px;"></i>
                        <span>æ–°å»ºæ–‡ä»¶å¤¹</span>
                    </button>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-sm btn-secondary" @click="showNewFilePanel()" title="åœ¨å½“å‰ç›®å½•æ–°å»ºæ–‡ä»¶" style="flex: 1 1 50%; justify-content: center; min-width: 0; padding: 4px 8px; line-height: 1.2;">
                            <i data-lucide="file-plus" style="width: 14px; height: 12px;"></i>
                            <span>æ–°å»ºæ–‡ä»¶</span>
                        </button>
                        <button class="btn btn-sm btn-secondary" @click="showUploadPanel()" title="ä¸Šä¼ æ–‡ä»¶" style="flex: 1 1 50%; justify-content: center; min-width: 0; padding: 4px 8px; line-height: 1.2;">
                            <i data-lucide="upload" style="width: 14px; height: 12px;"></i>
                            <span>ä¸Šä¼ </span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="current-path-indicator" style="margin: 12px;">
                <i data-lucide="folder" style="width: 12px; height: 12px; display: inline; vertical-align: middle;"></i>
                å½“å‰ç›®å½•ï¼š{{ currentDirectory || 'æ ¹ç›®å½•' }}
            </div>

            <div class="sidebar-content">
                <div v-if="loading" class="loading">
                    <div class="loading-container">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">{{ loadingText || 'æ­£åœ¨åŠ è½½æ–‡ä»¶...' }}</div>
                    </div>
                </div>
                <div v-else-if="fileTree.length === 0" class="empty-state">
                    <i data-lucide="folder-open" style="width: 32px; height: 32px;"></i>
                    <p>ä»“åº“ä¸ºç©º</p>
                </div>
                <div v-else class="file-tree">
                    <tree-node
                        v-for="node in fileTree"
                        :key="node.path"
                        :node="node"
                        :level="0"
                        :expanded-paths="expandedPaths"
                        :selected-path="selectedFile ? selectedFile.path : ''"
                        :editing-path="editingFilePath"
                        :current-directory="currentDirectory"
                        @toggle="toggleExpand"
                        @select="selectFile"
                        @select-directory="selectDirectory"
                        @rename="showRenamePanel"
                        @delete="deleteFile"
                        @move="showMovePanel"
                        @contextmenu="showContextMenu"
                        @newfile="showNewFilePanelAt"
                        @newfolder="showNewFolderPanelAt"
                    ></tree-node>
                </div>
            </div>

            <div class="sidebar-footer">
                <div style="font-size: 12px; color: #9ca3af;">
                    <i data-lucide="git-branch" style="width: 12px; height: 12px; display: inline; vertical-align: middle;"></i>
                    <span v-if="gitRepo">{{ gitRepo.split('/').pop().replace('.git', '') }}</span>
                    <span v-else>æœªé…ç½®</span>
                </div>
            </div>
        </div>

        <div class="main-content" :class="{ 'expanded': sidebarCollapsed }">
            <div class="content-area">
                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <i data-lucide="file-text" style="width: 24px; height: 24px;"></i>
                        </div>
                        <div class="stat-content">
                            <h3>{{ fileCount }}</h3>
                            <p>æ–‡ä»¶æ€»æ•°</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i data-lucide="folder" style="width: 24px; height: 24px;"></i>
                        </div>
                        <div class="stat-content">
                            <h3>{{ folderCount }}</h3>
                            <p>æ–‡ä»¶å¤¹</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon purple">
                            <i data-lucide="git-commit" style="width: 24px; height: 24px;"></i>
                        </div>
                        <div class="stat-content">
                            <h3>{{ changes.length }}</h3>
                            <p>å¾…æäº¤</p>
                        </div>
                    </div>
                </div>

                <div class="editor-container">
                    <div v-if="!editingFilePath" class="empty-state">
                        <i data-lucide="file-text" style="width: 48px; height: 48px;"></i>
                        <h3>é€‰æ‹©æ–‡ä»¶å¼€å§‹ç¼–è¾‘</h3>
                        <p>ä»å·¦ä¾§æ–‡ä»¶æµè§ˆå™¨ä¸­é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶</p>
                    </div>
                    <template v-else>
                        <div class="editor-header">
                            <div class="editor-file-info">
                                <i data-lucide="file-text" style="width: 16px; height: 16px; color: #3b82f6;"></i>
                                <span class="editor-file-path">{{ editingFilePath }}</span>
                                <span v-if="hasUnsavedChanges" class="unsaved-indicator">â— æœªä¿å­˜</span>
                            </div>
                            <button class="btn btn-sm btn-success" @click="saveFile()" :disabled="saving">
                                <i data-lucide="save" style="width: 12px; height: 12px;"></i>
                                <span>{{ saving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜' }}</span>
                            </button>
                        </div>
                        <div class="editor-content">
                            <div id="vditor"></div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <div class="overlay" :class="{ 'overlay-mobile-visible': showMobileOverlay }" v-show="panelOpen || showMobileOverlay" @click="handleOverlayClick"></div>

    <div class="side-panel" :class="{ 'open': panelOpen }">
        <div class="side-panel-header">
            <span class="side-panel-title">{{ panelTitle }}</span>
            <span class="side-panel-close" @click="closePanel">
                <i data-lucide="x" style="width: 18px; height: 18px;"></i>
            </span>
        </div>
        <div class="side-panel-content">
            <div v-if="panelType === 'newfile'">
                <div class="form-group">
                    <label class="form-label">æ–‡ä»¶å</label>
                    <input type="text" class="form-input" v-model="newFileName" placeholder="ä¾‹å¦‚: my-post.md" @keyup.enter="createFile">
                    <p class="form-hint">å°†åˆ›å»ºåœ¨ï¼š{{ currentDirectory || 'æ ¹ç›®å½•' }}</p>
                </div>
                <div class="form-group">
                    <label class="form-label">æ–‡ä»¶å†…å®¹ï¼ˆå¯é€‰ï¼‰</label>
                    <textarea class="form-textarea" v-model="newFileContent" placeholder="è¾“å…¥æ–‡ä»¶å†…å®¹..."></textarea>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" @click="closePanel">å–æ¶ˆ</button>
                    <button class="btn btn-primary" @click="createFile">åˆ›å»ºæ–‡ä»¶</button>
                </div>
            </div>

            <div v-if="panelType === 'newfolder'">
                <div class="form-group">
                    <label class="form-label">æ–‡ä»¶å¤¹å</label>
                    <input type="text" class="form-input" v-model="newFolderName" placeholder="ä¾‹å¦‚ï¼šmy-folder" @keyup.enter="createFolder">
                    <p class="form-hint">å°†åˆ›å»ºåœ¨ï¼š{{ currentDirectory || 'æ ¹ç›®å½•' }}</p>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" @click="closePanel">å–æ¶ˆ</button>
                    <button class="btn btn-primary" @click="createFolder">åˆ›å»ºæ–‡ä»¶å¤¹</button>
                </div>
            </div>

            <div v-if="panelType === 'upload'">
                <div class="form-group">
                    <label class="form-label">é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶</label>
                    <input type="file" class="form-input" @change="handleFileSelect" accept=".jpg,.jpeg,.png,.gif,.webp,.bmp,.ico,.md,.markdown,.txt,.json,.yaml,.yml,.toml">
                    <p class="form-hint">
                        ğŸ“· å›¾ç‰‡ï¼šJPG, PNG, GIF, WebP, BMP, ICO<br>
                        ğŸ“„ æ–‡æ¡£ï¼šMD, TXT<br>
                        âš™ï¸ é…ç½®ï¼šJSON, YAML, TOML<br>
                        æœ€å¤§æ–‡ä»¶å¤§å°ï¼š2MB
                    </p>
                </div>
                <div class="form-group" v-if="selectedFileForUpload">
                    <label class="form-label">æ–‡ä»¶å</label>
                    <input type="text" class="form-input" v-model="uploadFileName" placeholder="è¾“å…¥æ–°æ–‡ä»¶åï¼ˆå¯é€‰ï¼‰">
                    <p class="form-hint">
                        åŸå§‹æ–‡ä»¶åï¼š{{ selectedFileForUpload.name }}<br>
                        æ–‡ä»¶å¤§å°ï¼š{{ formatFileSize(selectedFileForUpload.size) }}
                    </p>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" @click="closePanel">å–æ¶ˆ</button>
                    <button class="btn btn-primary" @click="uploadFile" :disabled="!selectedFileForUpload">ä¸Šä¼ æ–‡ä»¶</button>
                </div>
            </div>

            <div v-if="panelType === 'rename'">
                <div class="form-group">
                    <label class="form-label">æ–°åç§°</label>
                    <input type="text" class="form-input" v-model="renameNewName" @keyup.enter="renameFile">
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" @click="closePanel">å–æ¶ˆ</button>
                    <button class="btn btn-primary" @click="renameFile">ç¡®è®¤é‡å‘½å</button>
                </div>
            </div>

            <div v-if="panelType === 'move'">
                <div class="form-group">
                    <label class="form-label">ç›®æ ‡è·¯å¾„</label>
                    <input type="text" class="form-input" v-model="moveDestPath">
                    <p class="form-hint">åŸè·¯å¾„ï¼š{{ moveSourcePath }}</p>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" @click="closePanel">å–æ¶ˆ</button>
                    <button class="btn btn-primary" @click="moveFile">ç¡®è®¤ç§»åŠ¨</button>
                </div>
            </div>

            <div v-if="panelType === 'config'" class="settings-panel-content" style="padding-bottom: 80px;">
                <div class="section-title">
                    <i data-lucide="git-branch" style="width: 16px; height: 16px;"></i>
                    Git ä»“åº“é…ç½®
                </div>
                <div class="form-group">
                    <label class="form-label">ä»“åº“åœ°å€</label>
                    <input type="text" class="form-input" v-model="gitRepo" placeholder="è¾“å…¥ Git ä»“åº“ HTTPS åœ°å€ï¼Œå¦‚ï¼šhttps://github.com/username/repo.git">
                    <p class="form-hint">ä½¿ç”¨ OAuth ç™»å½•åï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ä½¿ç”¨æ‚¨çš„ GitHub å‡­è¯è¿›è¡Œè®¤è¯</p>
                </div>
                
                <div class="section-divider"></div>
                
                <div class="section-title">
                    <i data-lucide="file-x" style="width: 16px; height: 16px;"></i>
                    æ–‡ä»¶æ˜¾ç¤ºè®¾ç½®
                </div>
                
                <div class="form-group">
                    <label class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
                        <span>æ˜¾ç¤ºæ¨¡å¼</span>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" v-model="useWhitelist" style="cursor: pointer;">
                            <span style="font-size: 13px; font-weight: normal;">åªæ˜¾ç¤ºå¸¸ç”¨æ–‡æœ¬æ–‡ä»¶</span>
                        </label>
                    </label>
                    <p class="form-hint">å¯ç”¨ååªæ˜¾ç¤º .md, .txt, .toml, .yaml, .yml, .json ç­‰é…ç½®æ–‡ä»¶</p>
                </div>
                
                <div class="form-group" v-if="useWhitelist">
                    <label class="form-label">ç™½åå•ä¾‹å¤–ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                    <textarea class="form-textarea" v-model="whitelistExceptions" rows="4" placeholder="src/&#10;assets/&#10;config.json&#10;package.json"></textarea>
                    <p class="form-hint">
                        åœ¨ç™½åå•æ¨¡å¼ä¸‹å…è®¸æ˜¾ç¤ºçš„é¢å¤–ç›®å½•/æ–‡ä»¶
                        <br>ç¤ºä¾‹ï¼š<code>src/</code> æ˜¾ç¤º src ç›®å½• | <code>config.json</code> æ˜¾ç¤ºè¯¥æ–‡ä»¶
                    </p>
                </div>
                
                <div class="section-divider"></div>
                
                <div class="section-title">
                    <i data-lucide="square-x" style="width: 16px; height: 16px;"></i>
                    æ’é™¤è§„åˆ™
                </div>
                
                <div class="section-subtitle">
                    <i data-lucide="type" style="width: 14px; height: 14px;"></i>
                    ç®€å•æ¨¡å¼ï¼ˆæ¨èï¼‰
                </div>
                <div class="form-group">
                    <label class="form-label">æ’é™¤åç¼€ã€æ–‡ä»¶åæˆ–ç›®å½•ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                    <textarea class="form-textarea" v-model="simplePatterns" rows="4" placeholder=".css&#10;.js&#10;.html&#10;dist/&#10;node_modules/"></textarea>
                    <p class="form-hint">
                        ç¤ºä¾‹ï¼š<code>.css</code> æ’é™¤ CSS æ–‡ä»¶ | <code>test.txt</code> æ’é™¤ç‰¹å®šæ–‡ä»¶ | <code>dist/</code> æ’é™¤ç›®å½•
                    </p>
                </div>
                
                <div class="pattern-templates">
                    <div class="pattern-template" @click="addSimplePattern('.css')" title="æ’é™¤ .css æ–‡ä»¶">
                        <code>.css</code>
                        <span>CSS</span>
                    </div>
                    <div class="pattern-template" @click="addSimplePattern('.js')" title="æ’é™¤ .js æ–‡ä»¶">
                        <code>.js</code>
                        <span>JS</span>
                    </div>
                    <div class="pattern-template" @click="addSimplePattern('.html')" title="æ’é™¤ .html æ–‡ä»¶">
                        <code>.html</code>
                        <span>HTML</span>
                    </div>
                    <div class="pattern-template" @click="addSimplePattern('.log')" title="æ’é™¤ .log æ–‡ä»¶">
                        <code>.log</code>
                        <span>æ—¥å¿—</span>
                    </div>
                    <div class="pattern-template" @click="addSimplePattern('dist/')" title="æ’é™¤ dist ç›®å½•">
                        <code>dist/</code>
                        <span>dist</span>
                    </div>
                    <div class="pattern-template" @click="addSimplePattern('node_modules/')" title="æ’é™¤ node_modules ç›®å½•">
                        <code>node_modules/</code>
                        <span>node_modules</span>
                    </div>
                    <div class="pattern-template" @click="addSimplePattern('.git/')" title="æ’é™¤ .git ç›®å½•">
                        <code>.git/</code>
                        <span>.git</span>
                    </div>
                    <div class="pattern-template" @click="addSimplePattern('build/')" title="æ’é™¤ build ç›®å½•">
                        <code>build/</code>
                        <span>build</span>
                    </div>
                </div>
                
                <div class="section-divider"></div>
                
                <div class="section-subtitle">
                    <i data-lucide="square-check" style="width: 14px; height: 14px;"></i>
                    æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼ˆé«˜çº§ï¼‰
                </div>
                <div class="form-group">
                    <label class="form-label">æ­£åˆ™è¡¨è¾¾å¼æ’é™¤ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                    <textarea class="form-textarea" v-model="excludePatterns" rows="4" placeholder=".*\.css$&#10;.*\.html$&#10;^temp/"></textarea>
                    <p class="form-hint">æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼Œä¿å­˜åè‡ªåŠ¨åˆ·æ–°ç”Ÿæ•ˆ</p>
                </div>
                
                <div class="pattern-templates">
                    <div class="pattern-template" @click="addPattern('.*\\.css$')" title="æ’é™¤ä»»æ„ç›®å½•ä¸‹çš„ .css æ–‡ä»¶">
                        <code>.*\.css$</code>
                        <span>CSS</span>
                    </div>
                    <div class="pattern-template" @click="addPattern('.*\\.html$')" title="æ’é™¤ä»»æ„ç›®å½•ä¸‹çš„ .html æ–‡ä»¶">
                        <code>.*\.html$</code>
                        <span>HTML</span>
                    </div>
                    <div class="pattern-template" @click="addPattern('.*\\.js$')" title="æ’é™¤ä»»æ„ç›®å½•ä¸‹çš„ .js æ–‡ä»¶">
                        <code>.*\.js$</code>
                        <span>JS</span>
                    </div>
                    <div class="pattern-template" @click="addPattern('^\\.')" title="æ’é™¤éšè—æ–‡ä»¶å’Œç›®å½•">
                        <code>^\.</code>
                        <span>éšè—æ–‡ä»¶</span>
                    </div>
                    <div class="pattern-template" @click="addPattern('.*\\.log$')" title="æ’é™¤æ—¥å¿—æ–‡ä»¶">
                        <code>.*\.log$</code>
                        <span>æ—¥å¿—</span>
                    </div>
                    <div class="pattern-template" @click="addPattern('^dist/')" title="æ’é™¤ dist ç›®å½•">
                        <code>^dist/</code>
                        <span>dist</span>
                    </div>
                </div>
                
                <div class="section-divider"></div>
                
                <div class="section-subtitle">
                    <i data-lucide="circle-help" style="width: 14px; height: 14px;"></i>
                    ä½¿ç”¨è¯´æ˜
                </div>
                <div class="regex-help">
                    <div class="help-item">
                        <strong>ç®€å•æ¨¡å¼ï¼š</strong>
                        <code>.css</code> æ’é™¤åç¼€ | 
                        <code>file.txt</code> æ’é™¤æ–‡ä»¶ | 
                        <code>dist/</code> æ’é™¤ç›®å½•
                    </div>
                    <div class="help-item">
                        <strong>æ­£åˆ™è¡¨è¾¾å¼ï¼š</strong>
                        <code>.*</code> ä»»æ„å­—ç¬¦ | 
                        <code>\.</code> ç‚¹å· | 
                        <code>$</code> ç»“å°¾ | 
                        <code>^</code> å¼€å¤´
                    </div>
                    <div class="help-item">
                        <strong>ç™½åå•ï¼š</strong> å¯ç”¨ååªæ˜¾ç¤º .md, .txt, .toml, .yaml, .yml, .json ç­‰æ–‡æœ¬/é…ç½®æ–‡ä»¶
                    </div>
                </div>
            </div>
            <div v-if="panelType === 'config'" class="side-panel-footer-fixed">
                <button class="btn btn-secondary" @click="closePanel">å–æ¶ˆ</button>
                <button class="btn btn-primary" @click="saveAllSettings">ä¿å­˜å…¨éƒ¨è®¾ç½®</button>
            </div>

            <div v-if="panelType === 'theme'">
                <div class="section-title">
                    <i data-lucide="palette" style="width: 16px; height: 16px;"></i>
                    ä¸»é¢˜é¢œè‰²
                </div>
                <div class="color-selector">
                    <div class="color-option" :class="{ 'active': currentColor === 'blue' }" @click="setColor('blue')">
                        <div class="color-option-preview" style="background: #2196f3;"></div>
                        <div class="color-option-name">è“è‰²</div>
                    </div>
                    <div class="color-option" :class="{ 'active': currentColor === 'green' }" @click="setColor('green')">
                        <div class="color-option-preview" style="background: #30a14e;"></div>
                        <div class="color-option-name">ç»¿è‰²</div>
                    </div>
                    <div class="color-option" :class="{ 'active': currentColor === 'red' }" @click="setColor('red')">
                        <div class="color-option-preview" style="background: #dc2626;"></div>
                        <div class="color-option-name">çº¢è‰²</div>
                    </div>
                    <div class="color-option" :class="{ 'active': currentColor === 'gold' }" @click="setColor('gold')">
                        <div class="color-option-preview" style="background: #d4af37;"></div>
                        <div class="color-option-name">é‡‘è‰²</div>
                    </div>
                </div>

                <div class="section-divider"></div>

                <div class="section-title">
                    <i data-lucide="sun" style="width: 16px; height: 16px;"></i>
                    æ˜¾ç¤ºæ¨¡å¼
                </div>
                <div class="mode-selector">
                    <div class="mode-option" :class="{ 'active': currentMode === 'light' }" @click="setMode('light')">
                        <i data-lucide="sun" style="width: 14px; height: 14px;"></i>
                        æµ…è‰²æ¨¡å¼
                    </div>
                    <div class="mode-option" :class="{ 'active': currentMode === 'dark' }" @click="setMode('dark')">
                        <i data-lucide="moon" style="width: 14px; height: 14px;"></i>
                        æ·±è‰²æ¨¡å¼
                    </div>
                </div>

                <div class="section-divider"></div>

                <div class="section-title">
                    <i data-lucide="edit-3" style="width: 16px; height: 16px;"></i>
                    ç¼–è¾‘å™¨æ¨¡å¼
                </div>
                <div class="editor-mode-selector">
                    <div class="editor-mode-option" :class="{ 'active': editorMode === 'wysiwyg' }" @click="setEditorMode('wysiwyg')">
                        <i data-lucide="eye" style="width: 14px; height: 14px;"></i>
                        æ‰€è§å³æ‰€å¾—
                    </div>
                    <div class="editor-mode-option" :class="{ 'active': editorMode === 'ir' }" @click="setEditorMode('ir')">
                        <i data-lucide="columns" style="width: 14px; height: 14px;"></i>
                        å³æ—¶æ¸²æŸ“
                    </div>
                    <div class="editor-mode-option" :class="{ 'active': editorMode === 'sv' }" @click="setEditorMode('sv')">
                        <i data-lucide="file-text" style="width: 14px; height: 14px;"></i>
                        åˆ†å±é¢„è§ˆ
                    </div>
                </div>
            </div>

            <div v-if="panelType === 'changes'">
                <div v-if="changes.length === 0" class="empty-state" style="height: 200px;">
                    <i data-lucide="check-circle" style="width: 32px; height: 32px; color: #10b981;"></i>
                    <h3 style="color: #10b981;">æ²¡æœ‰å¾…æäº¤çš„æ›´æ”¹</h3>
                </div>
                <div v-else>
                    <ul class="changes-list">
                        <li v-for="change in changes" :key="change">
                            <span class="change-icon modified">
                                <i data-lucide="edit-2" style="width: 10px; height: 10px;"></i>
                            </span>
                            {{ change }}
                        </li>
                    </ul>
                    <div class="form-actions">
                        <button class="btn btn-secondary" @click="closePanel">å–æ¶ˆ</button>
                        <button class="btn btn-success" @click="commit" :disabled="committing">
                            <i data-lucide="git-commit" style="width: 16px; height: 16px;" v-if="!committing"></i>
                            <i data-lucide="loader-2" style="width: 16px; height: 16px; animation: spin 1s linear infinite;" v-else></i>
                            <span>{{ committing ? 'æäº¤ä¸­...' : 'æäº¤å˜æ›´' }}</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div v-if="contextMenuVisible" class="context-menu" :style="{ top: contextMenuY + 'px', left: contextMenuX + 'px' }">
        <div class="context-menu-item" @click="openFile" v-if="contextMenuFile && contextMenuFile.type === 'file'">
            <i data-lucide="file-text" style="width: 14px; height: 14px;"></i>
            <span>æ‰“å¼€</span>
        </div>
        <template v-if="contextMenuFile && contextMenuFile.type === 'directory'">
            <div class="context-menu-item" @click="selectDirectory(contextMenuFile.path)">
                <i data-lucide="folder-open" style="width: 14px; height: 14px;"></i>
                <span>è®¾ä¸ºå½“å‰ç›®å½•</span>
            </div>
            <div class="context-menu-item" @click="newFileAtContext">
                <i data-lucide="file-plus" style="width: 14px; height: 14px;"></i>
                <span>æ–°å»ºæ–‡ä»¶</span>
            </div>
            <div class="context-menu-item" @click="newFolderAtContext">
                <i data-lucide="folder-plus" style="width: 14px; height: 14px;"></i>
                <span>æ–°å»ºæ–‡ä»¶å¤¹</span>
            </div>
        </template>
        <div class="context-menu-item" @click="renameContext">
            <i data-lucide="edit-3" style="width: 14px; height: 14px;"></i>
            <span>é‡å‘½å</span>
        </div>
        <div class="context-menu-item" @click="moveContext">
            <i data-lucide="move" style="width: 14px; height: 14px;"></i>
            <span>ç§»åŠ¨</span>
        </div>
        <div class="context-menu-item danger" @click="deleteContext">
            <i data-lucide="trash-2" style="width: 14px; height: 14px;"></i>
            <span>åˆ é™¤</span>
        </div>
    </div>

    <div class="toast" :class="[toastType, { 'show': toastVisible }]" v-cloak>
        <i :data-lucide="toastIcon" style="width: 16px; height: 16px;"></i>
        <span>{{ toastMessage }}</span>
    </div>

    <div v-if="modalVisible" class="modal-overlay" @click.self="cancelModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon" :class="modalType">
                    <i :data-lucide="modalIcon" style="width: 20px; height: 20px;"></i>
                </div>
                <span class="modal-title">{{ modalTitle }}</span>
            </div>
            <div class="modal-body">
                <p class="modal-message">{{ modalMessage }}</p>
                <div v-if="modalDetails && modalDetails.length" class="modal-details">
                    <ul>
                        <li v-for="detail in modalDetails" :key="detail">{{ detail }}</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" @click="cancelModal">å–æ¶ˆ</button>
                <button class="btn" :class="modalConfirmClass" @click="confirmModal">ç¡®è®¤</button>
            </div>
        </div>
    </div>
    
</div>

<script src="/static/oauth-component.js"></script>
  <script src="/static/main.js"></script>
</body>
</html>
